<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Sydney Informatics Hub – step2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Sydney Informatics Hub</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../00_setup.html">
 <span class="menu-text">Setup</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Introduction.html">
 <span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-1" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Session 1</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-1">
<li>
    <a class="dropdown-item" href="../100_dataset1/step1.html">
 <span class="dropdown-text">Predict the house sale price in Iowa - EDA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../100_dataset1/step2.html">
 <span class="dropdown-text">Get started with tidymodels</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-2" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Session 2</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-2">
<li>
    <a class="dropdown-item" href="../200_dataset2/step1.html">
 <span class="dropdown-text">Predict what makes a developer more likely to work remotely - EDA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../200_dataset2/step2.html">
 <span class="dropdown-text">Preprocess with a recipe</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session3-" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Session3</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session3-">
<li>
    <a class="dropdown-item" href="../300_dataset3/step1.html">
 <span class="dropdown-text">Predict which wine features are the best quality wine indicators - EDA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../300_dataset3/step2.html">
 <span class="dropdown-text">Create a modeling workflow</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-4" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Session 4</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-4">
<li>
    <a class="dropdown-item" href="../400_dataset4/step1.html">
 <span class="dropdown-text">Predict whether a cancer is malignant or benign from biopsy details - EDA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../400_dataset4/step2.html">
 <span class="dropdown-text">Work with model hyperparameters</span></a>
  </li>  
    </ul>
</li>
</ul>
<div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<div class="quarto-about-solana column-body">
  <div class="about-entity">
    <div class="entity-contents">
      <div class="about-contents"><main class="content" id="quarto-document-content"><div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Learning objective:
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>From base R to tidymodels;</li>
<li>Split our data into training and test sets;</li>
<li>Preprocess the training data;</li>
<li>Specify a linear regression model;</li>
<li>Train our model on the training data;</li>
<li>Transform the test data and obtain predictions using our trained model.</li>
</ul>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise:
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this case study, you will predict houses selling price from characteristics of these houses, like size and layout of the living space in the house. What kind of model will you build?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>To predict a continuous, numeric quantity like selling price, use regression models.</p>
</div>
</div>
</div>
<p>Load in the packages we’ll be using for modelling:</p>
<div class="cell">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rsample.tidymodels.org">rsample</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/koalaverse/vip/">vip</a></span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
</div>
<section id="build-a-simple-linear-regression-model-using-base-r" class="level3"><h3 data-anchor-id="build-a-simple-linear-regression-model-using-base-r">Build a simple linear regression model using base R</h3>
<hr>
<p>In a linear model, we assume that there is a linear relationship between the input variable(s) and the output variable. This means that as the input variable(s) increase or decrease, the output variable changes in a straight line.</p>
<p>Imagine you have a scatter plot with your data points all over it. A linear model is like drawing a straight line through the scatter plot that best fits all the points. The slope and intercept of this line are chosen in such a way that the distance between the line and all the points is minimized. This line is then used to predict the output for new input values.</p>
<div class="quarto-figure quarto-figure-left">
<figure class="figure"><p><img src="../fig/lm.png" class="img-fluid figure-img" width="500"></p>
<p></p><figcaption class="figure-caption">Example of a linear model</figcaption><p></p>
</figure>
</div>
<p>The straight red dotted line represents the linear model equation <span class="math inline">\(y=mx+c\)</span>, where <span class="math inline">\(c\)</span> is the y-intercept of the regression line, <span class="math inline">\(m\)</span> is the slope of the regression line, and <span class="math inline">\(y\)</span> is the expected value for y for the given <span class="math inline">\(x\)</span> value.</p>
<div class="cell">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#fit a linear model</span></span>
<span><span class="va">ames_lm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">Gr_Liv_Area</span>, data <span class="op">=</span> <span class="va">ames_data</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#Print the summary of the model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">ames_lm</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Sale_Price ~ Gr_Liv_Area, data = ames_data)
Residuals:
     Min       1Q   Median       3Q      Max 
-0.94258 -0.06622  0.01359  0.07298  0.39246 
Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 4.835e+00  7.406e-03  652.80   &lt;2e-16 ***
Gr_Liv_Area 2.579e-04  4.714e-06   54.72   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
Residual standard error: 0.124 on 2923 degrees of freedom
Multiple R-squared:  0.506, Adjusted R-squared:  0.5058 
F-statistic:  2994 on 1 and 2923 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p>R-squared value explains the variability of y with respect to x:</p>
<ul>
<li>varies between 0 to 1;</li>
<li>R-squared values closer to 0 mean the regression relationship is very low;</li>
<li>R-squared values closer to 1 mean the regression relationship is very strong.</li>
</ul>
<p>Let’s plot our linear regression model:</p>
<div class="cell">
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="va">ames_data</span><span class="op">$</span><span class="va">Gr_Liv_Area</span>, <span class="va">ames_data</span><span class="op">$</span><span class="va">Sale_Price</span>,</span>
<span>     xlab<span class="op">=</span><span class="st">"Gr_Liv_Area"</span>,</span>
<span>     ylab<span class="op">=</span><span class="st">"Sale_Price"</span>, </span>
<span>     col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span><span class="va">ames_lm</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="step2_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="build-a-linear-regression-model-using-tidymodels" class="level3"><h3 data-anchor-id="build-a-linear-regression-model-using-tidymodels">Build a linear regression model using Tidymodels</h3>
<hr>
<p>When you type library(tidymodels), you load a collection of packages for modeling and machine learning using tidyverse principles. All the packages are designed to be consistent, modular, and to support good modeling practices. The first thing we are going to practice is splitting your data into a training set and a testing set. The tidymodels package <code>rsample</code> has functions that help you specify training and testing sets.</p>
<div class="cell">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span> <span class="co">#so we all get the same results</span></span>
<span><span class="va">ames_split</span> <span class="op">&lt;-</span> <span class="va">ames_data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">initial_split</a></span><span class="op">(</span>prop <span class="op">=</span> <span class="fl">0.8</span>,</span>
<span>                  strata <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span> <span class="co">#stratification</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Stratified sampling would split within each quartile: <img src="../fig/strata.png" class="img-fluid" alt="strata"></p>
<div class="cell">
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_train</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">training</a></span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span>
<span><span class="va">ames_test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/initial_split.html">testing</a></span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">ames_train</span>, <span class="st">"../_models/ames_train.Rds"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">ames_test</span>, <span class="st">"../_models/ames_test.Rds"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The code here takes an input data set and puts 80% of it into a training dataset and 20% of it into a testing dataset; it chooses the individual cases so that both sets are balanced in selling price.</p>
<div class="cell">
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="va">Sale_Price</span><span class="op">)</span>,  col <span class="op">=</span> <span class="st">"red"</span>, fill <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html">geom_density</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ames_test</span>,</span>
<span>            stat <span class="op">=</span> <span class="st">"density"</span>,</span>
<span>            col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="step2_files/figure-html/distr test and train-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section><section id="feature-engineering" class="level2"><h2 data-anchor-id="feature-engineering">Feature engineering</h2>
<p>In tidymodels, you can preprocess your data using the <em>recipes</em> package. Typical preprocessing steps include:</p>
<ul>
<li>Scaling and centering numeric predictors;</li>
<li>Removing skewness from numeric variables;</li>
<li>One-hot and dummy variable encoding for categorical variables;</li>
<li>Removing correlated predictors and zero variance variables;</li>
<li>Imputing missing data.</li>
</ul>
<p>Each successive step() function adds a preprocessing step to our recipe object in the order that they are provided:</p>
<div class="cell">
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_rec</span> <span class="op">&lt;-</span></span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">step_other</span><span class="op">(</span><span class="fu">all_nominal</span><span class="op">(</span><span class="op">)</span>, threshold <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#useful when you have some factor levels with very few observations, all_nominal selects both characters and factors, pools infrequently occurring values (frequency less than 0.01) into an "other" category</span></span>
<span>  <span class="fu">step_nzv</span><span class="op">(</span><span class="fu">all_nominal</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#remove variables that are highly sparse and unbalanced</span></span>
<span>  <span class="fu">step_center</span><span class="op">(</span><span class="fu">all_numeric</span><span class="op">(</span><span class="op">)</span>, <span class="op">-</span><span class="fu">all_outcomes</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#subtracts the column mean from a variable</span></span>
<span>  <span class="fu">step_scale</span><span class="op">(</span><span class="fu">all_numeric</span><span class="op">(</span><span class="op">)</span>, <span class="op">-</span><span class="fu">all_outcomes</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#divides by the standard deviation</span></span>
<span>  <span class="fu">step_dummy</span><span class="op">(</span><span class="fu">all_nominal</span><span class="op">(</span><span class="op">)</span>, <span class="op">-</span><span class="fu">all_outcomes</span><span class="op">(</span><span class="op">)</span>, one_hot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co">#create dummy variables for all nominal variables except the outcome variable </span></span>
<span></span>
<span><span class="va">ames_rec</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Recipe
Inputs:
      role #variables
   outcome          1
 predictor         80
Operations:
Collapsing factor levels for all_nominal()
Sparse, unbalanced variable filter on all_nominal()
Centering for all_numeric(), -all_outcomes()
Scaling for all_numeric(), -all_outcomes()
Dummy variables from all_nominal(), -all_outcomes()</code></pre>
</div>
</div>
<p>The preprocessing recipe <code>ames_rec</code> has been defined but no values have been estimated.</p>
<ul>
<li>The <code>prep()</code> function takes that defined object and computes everything so that the preprocessing steps can be executed. Note that This is done with the training data.</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_prep</span> <span class="op">&lt;-</span> <span class="fu">prep</span><span class="op">(</span><span class="va">ames_rec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_prep</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Recipe
Inputs:
      role #variables
   outcome          1
 predictor         80
Training data contained 2339 data points and no missing data.
Operations:
Collapsing factor levels for MS_SubClass, MS_Zoning, Street, Lot_Shape, Util... [trained]
Sparse, unbalanced variable filter removed Street, Alley, Land_Contour, Utilities,... [trained]
Centering for Lot_Frontage, Lot_Area, Mas_Vnr_Area, BsmtFin_S... [trained]
Scaling for Lot_Frontage, Lot_Area, Mas_Vnr_Area, BsmtFin_S... [trained]
Dummy variables from MS_SubClass, MS_Zoning, Lot_Shape, Lot_Config, Neighborho... [trained]</code></pre>
</div>
</div>
<p>The <code>bake() and juice() functions both return data, not a preprocessing recipe object.  - The</code>bake()<code>function takes a prepped recipe (one that has had all quantities estimated from training data) and applies it to</code>new_data`. That new_data could be the training data again or it could be the testing data (with the TRAINING parameters)</p>
<div class="cell">
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_test_proc</span> <span class="op">&lt;-</span> <span class="fu">bake</span><span class="op">(</span><span class="va">ames_prep</span>, new_data <span class="op">=</span> <span class="va">ames_test</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li>The <code>juice()</code> function is a nice little shortcut. When we <code>juice()</code> the recipe, we squeeze that training data back out, transformed in the ways we specified. Let’s compare the <code>bake()</code> and <code>juice()</code> outputs:</li>
</ul>
<div class="cell">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">bake</span><span class="op">(</span><span class="va">ames_prep</span>, new_data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,339 × 231
   Lot_Frontage Lot_Area Mas_V…¹ BsmtF…² BsmtF…³ Bsmt_…⁴ Total…⁵ First…⁶ Secon…⁷
          &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1       0.374   -0.212   -0.569  -1.42    0.162  -1.27  -0.388   -0.726  -0.786
 2       0.374    0.0383  -0.569  -1.42   -0.298  -0.288 -0.430   -0.774  -0.786
 3      -0.137   -0.733   -0.569  -1.42   -0.298   0.341  0.0550  -0.231  -0.786
 4      -1.01    -0.943   -0.569   1.27   -0.298   0.630 -0.497   -0.848  -0.786
 5      -0.0770  -0.273   -0.569   1.27   -0.298   0.816 -0.303   -0.631  -0.786
 6      -0.227   -0.359   -0.569  -1.42    0.416  -1.27  -0.714   -1.07   -0.786
 7       0.374   -0.0453  -0.569   1.27   -0.298   0.584 -0.544   -0.382  -0.786
 8       0.314   -0.149   -0.569   0.372  -0.298  -1.27  -2.48     0.427   0.579
 9      -1.73    -0.0430  -0.391  -0.970  -0.298  -0.288 -0.388   -0.678  -0.786
10      -1.73    -0.392   -0.569  -1.42   -0.298  -0.404 -0.0137  -0.308  -0.786
# … with 2,329 more rows, 222 more variables: Low_Qual_Fin_SF &lt;dbl&gt;,
#   Gr_Liv_Area &lt;dbl&gt;, Bsmt_Full_Bath &lt;dbl&gt;, Bsmt_Half_Bath &lt;dbl&gt;,
#   Full_Bath &lt;dbl&gt;, Half_Bath &lt;dbl&gt;, Bedroom_AbvGr &lt;dbl&gt;, Kitchen_AbvGr &lt;dbl&gt;,
#   TotRms_AbvGrd &lt;dbl&gt;, Fireplaces &lt;dbl&gt;, Garage_Cars &lt;dbl&gt;,
#   Garage_Area &lt;dbl&gt;, Wood_Deck_SF &lt;dbl&gt;, Open_Porch_SF &lt;dbl&gt;,
#   Enclosed_Porch &lt;dbl&gt;, Three_season_porch &lt;dbl&gt;, Screen_Porch &lt;dbl&gt;,
#   Pool_Area &lt;dbl&gt;, Misc_Val &lt;dbl&gt;, Mo_Sold &lt;dbl&gt;, Year_Sold &lt;dbl&gt;, …</code></pre>
</div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu">juice</span><span class="op">(</span><span class="va">ames_prep</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2,339 × 231
   Lot_Frontage Lot_Area Mas_V…¹ BsmtF…² BsmtF…³ Bsmt_…⁴ Total…⁵ First…⁶ Secon…⁷
          &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1       0.374   -0.212   -0.569  -1.42    0.162  -1.27  -0.388   -0.726  -0.786
 2       0.374    0.0383  -0.569  -1.42   -0.298  -0.288 -0.430   -0.774  -0.786
 3      -0.137   -0.733   -0.569  -1.42   -0.298   0.341  0.0550  -0.231  -0.786
 4      -1.01    -0.943   -0.569   1.27   -0.298   0.630 -0.497   -0.848  -0.786
 5      -0.0770  -0.273   -0.569   1.27   -0.298   0.816 -0.303   -0.631  -0.786
 6      -0.227   -0.359   -0.569  -1.42    0.416  -1.27  -0.714   -1.07   -0.786
 7       0.374   -0.0453  -0.569   1.27   -0.298   0.584 -0.544   -0.382  -0.786
 8       0.314   -0.149   -0.569   0.372  -0.298  -1.27  -2.48     0.427   0.579
 9      -1.73    -0.0430  -0.391  -0.970  -0.298  -0.288 -0.388   -0.678  -0.786
10      -1.73    -0.392   -0.569  -1.42   -0.298  -0.404 -0.0137  -0.308  -0.786
# … with 2,329 more rows, 222 more variables: Low_Qual_Fin_SF &lt;dbl&gt;,
#   Gr_Liv_Area &lt;dbl&gt;, Bsmt_Full_Bath &lt;dbl&gt;, Bsmt_Half_Bath &lt;dbl&gt;,
#   Full_Bath &lt;dbl&gt;, Half_Bath &lt;dbl&gt;, Bedroom_AbvGr &lt;dbl&gt;, Kitchen_AbvGr &lt;dbl&gt;,
#   TotRms_AbvGrd &lt;dbl&gt;, Fireplaces &lt;dbl&gt;, Garage_Cars &lt;dbl&gt;,
#   Garage_Area &lt;dbl&gt;, Wood_Deck_SF &lt;dbl&gt;, Open_Porch_SF &lt;dbl&gt;,
#   Enclosed_Porch &lt;dbl&gt;, Three_season_porch &lt;dbl&gt;, Screen_Porch &lt;dbl&gt;,
#   Pool_Area &lt;dbl&gt;, Misc_Val &lt;dbl&gt;, Mo_Sold &lt;dbl&gt;, Year_Sold &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>It is the same as bake(ames_rep, new_data = ames_train) and is just a shortcut that we are going to use later.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Challenge X
</div>
</div>
<div class="callout-body-container callout-body">
<p>Does it make sense to apply these preprocessing steps to the test set?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>No, it doesn’t. You want the set test to look like new data that your model will see in the future, so you don’t want to mess with the class balance there; you want to see how your model will perform on imbalanced data, even if you have trained it on artificially balanced data.</p>
</div>
</div>
</div>
<section id="build-the-model" class="level3"><h3 data-anchor-id="build-the-model">Build the model</h3>
<p>In tidymodels, you specify models using three concepts.</p>
<ul>
<li>Model <strong>type</strong> differentiates models such as logistic regression, decision tree models, and so forth;</li>
<li>Model <strong>mode</strong> includes common options like regression and classification, some model types support either of these while some only have one mode;</li>
<li>Model <strong>engine</strong> is the computational tool which will be used to fit the model.</li>
</ul>
<p>We will specify the model using the <code>parsnip</code> package - Many functions have different interfaces and arguments names and parsnip standardizes the interface for fitting models as well as the return values.</p>
<div class="cell">
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#a linear regression model specification</span></span>
<span><span class="va">ames_model</span> <span class="op">&lt;-</span> <span class="fu">linear_reg</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="co">#pick a model</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"lm"</span><span class="op">)</span>           <span class="co">#set the engine</span></span>
<span>                             <span class="co">#set_mode("regression") we don't need this as the model linear_reg() only does regression</span></span>
<span></span>
<span><span class="co">#view model properties</span></span>
<span><span class="va">ames_model</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Linear Regression Model Specification (regression)
Computational engine: lm </code></pre>
</div>
</div>
<p>Now we are ready to train our model object on the training data. We can do this using the <code>fit()</code> function from the parsnip package. The <code>fit()</code> function takes the following arguments:</p>
<ul>
<li>a parnsip model object specification;</li>
<li>a model formula</li>
<li>a data frame with the training data</li>
</ul>
<p>The code below trains our linear regression model on the prepped training data. In our formula, we have specified that Sale_Price is the response variable and included all the rest as our predictor variables.</p>
<div class="cell">
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_fit</span> <span class="op">&lt;-</span> <span class="va">ames_model</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">fit</span><span class="op">(</span><span class="va">Sale_Price</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>      data<span class="op">=</span><span class="fu">juice</span><span class="op">(</span><span class="va">ames_prep</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># View lm_fit properties</span></span>
<span><span class="va">ames_fit</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>parsnip model object
Call:
stats::lm(formula = Sale_Price ~ ., data = data)
Coefficients:
                                          (Intercept)  
                                            4.2344150  
                                         Lot_Frontage  
                                            0.0010509  
                                             Lot_Area  
                                            0.0056766  
                                         Mas_Vnr_Area  
                                            0.0033526  
                                         BsmtFin_SF_1  
                                            0.0288579  
                                         BsmtFin_SF_2  
                                           -0.0024142  
                                          Bsmt_Unf_SF  
                                           -0.0096332  
                                        Total_Bsmt_SF  
                                            0.0293221  
                                         First_Flr_SF  
                                            0.0428570  
                                        Second_Flr_SF  
                                            0.0514152  
                                      Low_Qual_Fin_SF  
                                            0.0043645  
                                          Gr_Liv_Area  
                                                   NA  
                                       Bsmt_Full_Bath  
                                            0.0046797  
                                       Bsmt_Half_Bath  
                                            0.0008760  
                                            Full_Bath  
                                            0.0075337  
                                            Half_Bath  
                                            0.0063545  
                                        Bedroom_AbvGr  
                                           -0.0042524  
                                        Kitchen_AbvGr  
                                           -0.0032240  
                                        TotRms_AbvGrd  
                                            0.0010374  
                                           Fireplaces  
                                            0.0048444  
                                          Garage_Cars  
                                            0.0088917  
                                          Garage_Area  
                                            0.0054821  
                                         Wood_Deck_SF  
                                            0.0028177  
                                        Open_Porch_SF  
                                            0.0018956  
                                       Enclosed_Porch  
                                            0.0035592  
                                   Three_season_porch  
                                            0.0006254  
                                         Screen_Porch  
                                            0.0057138  
                                            Pool_Area  
                                           -0.0001730  
                                             Misc_Val  
                                            0.0008810  
                                              Mo_Sold  
                                           -0.0003984  
                                            Year_Sold  
                                           -0.0019209  
                                            Longitude  
                                           -0.0097179  
                                             Latitude  
                                           -0.0059391  
                                   Time_Since_Remodel  
                                           -0.0057059  
                                            House_Age  
                                           -0.0214642  
      MS_SubClass_One_Story_1946_and_Newer_All_Styles  
                                            0.0061643  
                 MS_SubClass_One_Story_1945_and_Older  
                                           -0.0206969  
     MS_SubClass_One_and_Half_Story_Finished_All_Ages  
                                            0.0282382  
                 MS_SubClass_Two_Story_1946_and_Newer  
                                           -0.0138448  
                 MS_SubClass_Two_Story_1945_and_Older  
                                            0.0158489  
                      MS_SubClass_Split_or_Multilevel  
                                           -0.0153464  
                              MS_SubClass_Split_Foyer  
                                            0.0073930  
               MS_SubClass_Duplex_All_Styles_and_Ages  
                                            0.0123223  
             MS_SubClass_One_Story_PUD_1946_and_Newer  
                                            0.0186726  
             MS_SubClass_Two_Story_PUD_1946_and_Newer  
                                           -0.0290154  
MS_SubClass_Two_Family_conversion_All_Styles_and_Ages  
                                            0.0126693  
                                    MS_SubClass_other  
                                                   NA  
               MS_Zoning_Floating_Village_Residential  
                                            0.0369229  
                    MS_Zoning_Residential_Low_Density  
                                            0.0295723  
                 MS_Zoning_Residential_Medium_Density  
                                            0.0224024  
                                      MS_Zoning_other  
                                                   NA  
                                    Lot_Shape_Regular  
                                            0.0047757  
                         Lot_Shape_Slightly_Irregular  
                                            0.0045442  
                       Lot_Shape_Moderately_Irregular  
                                            0.0167009  
                                      Lot_Shape_other  
                                                   NA  
                                    Lot_Config_Corner  
                                            0.0061984  
                                   Lot_Config_CulDSac  
                                            0.0124304  
                                       Lot_Config_FR2  
                                           -0.0034930  
                                    Lot_Config_Inside  
                                            0.0041820  
                                     Lot_Config_other  
                                                   NA  
                              Neighborhood_North_Ames  
                                           -0.0144052  
                           Neighborhood_College_Creek  
                                           -0.0403143  
                                Neighborhood_Old_Town  
                                           -0.0395437  
                                 Neighborhood_Edwards  
                                           -0.0485293  
                                Neighborhood_Somerset  
                                            0.0158820  
                      Neighborhood_Northridge_Heights  
                                            0.0152055  
                                 Neighborhood_Gilbert  
                                           -0.0076228  
                                  Neighborhood_Sawyer  
                                           -0.0245480  
                          Neighborhood_Northwest_Ames  
                                           -0.0147878  
                             Neighborhood_Sawyer_West  
                                           -0.0382249  
                                Neighborhood_Mitchell  
                                           -0.0254694  
                               Neighborhood_Brookside  
                                           -0.0110661  
                                Neighborhood_Crawford  
                                            0.0154749  
                  Neighborhood_Iowa_DOT_and_Rail_Road  
                                           -0.0481840  
                              Neighborhood_Timberland  
                                           -0.0246553  
                              Neighborhood_Northridge  
                                            0.0109785  
                             Neighborhood_Stone_Brook  
                                            0.0376989  
 Neighborhood_South_and_West_of_Iowa_State_University  
                                           -0.0339271  
                             Neighborhood_Clear_Creek  
                                           -0.0170590  
                          Neighborhood_Meadow_Village  
                                           -0.0629992  
                                   Neighborhood_other  
                                                   NA  
                                   Condition_1_Artery  
                                           -0.0179882  
                                    Condition_1_Feedr  
                                           -0.0119543  
                                     Condition_1_Norm  
                                            0.0063617  
                                     Condition_1_PosN  
                                            0.0101914  
                                     Condition_1_RRAn  
                                           -0.0142278  
                                    Condition_1_other  
                                                   NA  
                                     Bldg_Type_OneFam  
                                            0.0352264  
                                   Bldg_Type_TwoFmCon  
                                            0.0217637  
                                     Bldg_Type_Duplex  
                                                   NA  
                                      Bldg_Type_Twnhs  
                                           -0.0164880  
                                     Bldg_Type_TwnhsE  
                                                   NA  
                         House_Style_One_and_Half_Fin  
                                           -0.0334739  
                                House_Style_One_Story  
                                           -0.0113905  
                                   House_Style_SFoyer  
                                           -0.0045098  
                                     House_Style_SLvl  
                                            0.0080461  
                                House_Style_Two_Story  
                                           -0.0068768  
                                    House_Style_other  
                                                   NA  
                                    Overall_Qual_Fair  
                                           -0.0090491  
                           Overall_Qual_Below_Average  
                                           -0.0081678  
                                 Overall_Qual_Average  
                                            0.0135609  
                           Overall_Qual_Above_Average  
                                            0.0228156  
                                    Overall_Qual_Good  
                                            0.0317333  
                               Overall_Qual_Very_Good  
                                            0.0506332  
                               Overall_Qual_Excellent  
                                            0.0543703  
                                   Overall_Qual_other  
                                                   NA  
                                    Overall_Cond_Fair  
                                            0.0861003  
                           Overall_Cond_Below_Average  
                                            0.1382136  
                                 Overall_Cond_Average  
                                            0.1659276  
                           Overall_Cond_Above_Average  
                                            0.1795836  
                                    Overall_Cond_Good  
                                            0.1982810  
                               Overall_Cond_Very_Good  
                                            0.2021602  
                               Overall_Cond_Excellent  
                                            0.2216273  
                                   Overall_Cond_other  
                                                   NA  
                                     Roof_Style_Gable  
                                            0.0041041  
                                       Roof_Style_Hip  
                                            0.0013475  
                                     Roof_Style_other  
                                                   NA  
                                 Exterior_1st_AsbShng  
                                           -0.0197379  
                                 Exterior_1st_BrkFace  
                                            0.0218545  
                                 Exterior_1st_CemntBd  
                                           -0.0675824  
                                 Exterior_1st_HdBoard  
                                           -0.0177946  
                                 Exterior_1st_MetalSd  
                                           -0.0041764  
                                 Exterior_1st_Plywood  
                                           -0.0147857  
                                  Exterior_1st_Stucco  
                                           -0.0150856  
                                 Exterior_1st_VinylSd  
                                           -0.0269952  
                                 Exterior_1st_Wd.Sdng  
                                           -0.0127229  
                                 Exterior_1st_WdShing  
                                           -0.0219538  
                                   Exterior_1st_other  
                                                   NA  
                                 Exterior_2nd_AsbShng  
                                           -0.0294565  
                                 Exterior_2nd_BrkFace  
                                           -0.0252434  
                                 Exterior_2nd_CmentBd  
                                            0.0511306  
                                 Exterior_2nd_HdBoard  
                                           -0.0066992  
                                 Exterior_2nd_MetalSd  
                                           -0.0094713  
                                 Exterior_2nd_Plywood  
                                           -0.0088774  
                                  Exterior_2nd_Stucco  
                                            0.0028778  
                                 Exterior_2nd_VinylSd  
                                            0.0061450  
                                 Exterior_2nd_Wd.Sdng  
                                           -0.0049424  
                                 Exterior_2nd_Wd.Shng  
                                           -0.0005624  
                                   Exterior_2nd_other  
                                                   NA  
                                 Mas_Vnr_Type_BrkFace  
                                            0.0119788  
                                    Mas_Vnr_Type_None  
                                            0.0132996  
                                   Mas_Vnr_Type_Stone  
                                            0.0202174  
                                   Mas_Vnr_Type_other  
                                                   NA  
                                 Exter_Qual_Excellent  
                                            0.0412905  
                                      Exter_Qual_Fair  
                                           -0.0100946  
                                      Exter_Qual_Good  
                                            0.0067359  
                                   Exter_Qual_Typical  
                                                   NA  
                                      Exter_Cond_Fair  
                                           -0.0537435  
                                      Exter_Cond_Good  
                                           -0.0271431  
                                   Exter_Cond_Typical  
                                           -0.0190455  
                                     Exter_Cond_other  
                                                   NA  
                                    Foundation_BrkTil  
                                           -0.0221335  
                                    Foundation_CBlock  
                                           -0.0197832  
                                     Foundation_PConc  
                                           -0.0113600  
                                      Foundation_Slab  
                                           -0.0024282  
                                     Foundation_other  
                                                   NA  
                                  Bsmt_Qual_Excellent  
                                            0.0296809  
                                       Bsmt_Qual_Fair  
                                            0.0030970  
                                       Bsmt_Qual_Good  
                                            0.0160700  
                                Bsmt_Qual_No_Basement  
                                            0.0188896  
                                    Bsmt_Qual_Typical  
                                            0.0147692  
                                      Bsmt_Qual_other  
                                                   NA  
                                     Bsmt_Exposure_Av  
                                            0.0038457  
                                     Bsmt_Exposure_Gd  
                                            0.0268377  
                                     Bsmt_Exposure_Mn  
                                            0.0001947  
                                     Bsmt_Exposure_No  
                                           -0.0028258  
                            Bsmt_Exposure_No_Basement  
                                                   NA  
                                   BsmtFin_Type_1_ALQ  
                                            0.0837734  
                                   BsmtFin_Type_1_BLQ  
                                            0.0662634  
                                   BsmtFin_Type_1_GLQ  
                                            0.0596601  
                                   BsmtFin_Type_1_LwQ  
                                            0.0329057  
                           BsmtFin_Type_1_No_Basement  
                                                   NA  
                                   BsmtFin_Type_1_Rec  
                                            0.0072722  
                                   BsmtFin_Type_1_Unf  
                                                   NA  
                                 Heating_QC_Excellent  
                                            0.7700744  
                                      Heating_QC_Fair  
                                            0.7444348  
                                      Heating_QC_Good  
                                            0.7633523  
                                   Heating_QC_Typical  
                                            0.7575195  
                                     Heating_QC_other  
                                                   NA  
                                        Central_Air_N  
                                           -0.0232337  
                                        Central_Air_Y  
                                                   NA  
                                     Electrical_FuseA  
                                           -0.0134919  
                                     Electrical_FuseF  
                                           -0.0188211  
                                     Electrical_SBrkr  
                                           -0.0171300  
                                     Electrical_other  
                                                   NA  
                               Kitchen_Qual_Excellent  
                                            0.0303544  
                                    Kitchen_Qual_Fair  
                                           -0.0005397  
                                    Kitchen_Qual_Good  
                                            0.0050291  
                                 Kitchen_Qual_Typical  
                                                   NA  
                                   Kitchen_Qual_other  
                                                   NA  
                               Fireplace_Qu_Excellent  
                                           -0.0115950  
                                    Fireplace_Qu_Fair  
                                           -0.0047983  
                                    Fireplace_Qu_Good  
                                            0.0043227  
                            Fireplace_Qu_No_Fireplace  
                                           -0.0029386  
                                    Fireplace_Qu_Poor  
                                           -0.0089229  
                                 Fireplace_Qu_Typical  
                                                   NA  
                                   Garage_Type_Attchd  
                                            0.0277848  
                                  Garage_Type_Basment  
                                            0.0183001  
                                  Garage_Type_BuiltIn  
                                            0.0259155  
                                   Garage_Type_Detchd  
                                            0.0246522  
                                Garage_Type_No_Garage  
                                            0.0012371  
                                    Garage_Type_other  
                                                   NA  
                                    Garage_Finish_Fin  
                                            0.0004798  
                              Garage_Finish_No_Garage  
                                           -0.0064210  
                                    Garage_Finish_RFn  
                                           -0.0033819  
                                    Garage_Finish_Unf  
                                                   NA  
                                     Garage_Qual_Fair  
                                           -0.0243010  
                                Garage_Qual_No_Garage  
                                                   NA  
                                  Garage_Qual_Typical  
                                           -0.0147644  
                                    Garage_Qual_other  
                                                   NA  
                                     Garage_Cond_Fair  
                                           -0.0288340  
                                Garage_Cond_No_Garage  
                                                   NA  
                                  Garage_Cond_Typical  
                                           -0.0058730  
                                    Garage_Cond_other  
                                                   NA  
                              Paved_Drive_Dirt_Gravel  
                                           -0.0044010  
                         Paved_Drive_Partial_Pavement  
                                           -0.0080910  
                                    Paved_Drive_Paved  
                                                   NA  
                                   Fence_Good_Privacy  
                                           -0.0068390  
                                      Fence_Good_Wood  
                                           -0.0129793  
                                Fence_Minimum_Privacy  
                                           -0.0040916  
                                       Fence_No_Fence  
                                           -0.0050151  
                                          Fence_other  
                                                   NA  
                                        Sale_Type_COD  
                                           -0.0202250  
                                        Sale_Type_New  
                                            0.0181473  
                                        Sale_Type_WD.  
                                           -0.0182848  
                                      Sale_Type_other  
                                                   NA  
                               Sale_Condition_Abnorml  
                                           -0.0451496  
                                Sale_Condition_Family  
                                           -0.0225266  
                                Sale_Condition_Normal  
                                           -0.0017995  
                               Sale_Condition_Partial  
                                           -0.0222955  
                                 Sale_Condition_other  
                                                   NA  </code></pre>
</div>
</div>
<p>To obtain the detailed results from our trained linear regression model in a data frame, we can use the <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code> and <code>glance()</code> functions directly on our trained parsnip model, ames_fit. - The <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code> function takes a linear regression object and returns a data frame of the estimated model coefficients and their associated F-statistics and p-values; - The <code>glance()</code> function will return performance metrics obtained on the training data such as the R2 value (r.squared) and the RMSE (sigma). - We can also use the <code><a href="https://rdrr.io/pkg/vip/man/vip.html">vip()</a></code> function to plot the variable importance for each predictor in our model. The importance value is determined based on the F-statistics and estimate coefficents in our trained model object.</p>
<div class="cell">
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Data frame of estimated coefficients</span></span>
<span><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">ames_fit</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 231 × 5
   term          estimate std.error statistic   p.value
   &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
 1 (Intercept)    4.23      0.0959     44.2   1.44e-303
 2 Lot_Frontage   0.00105   0.00121     0.868 3.85e-  1
 3 Lot_Area       0.00568   0.00129     4.40  1.12e-  5
 4 Mas_Vnr_Area   0.00335   0.00167     2.01  4.50e-  2
 5 BsmtFin_SF_1   0.0289    0.0247      1.17  2.42e-  1
 6 BsmtFin_SF_2  -0.00241   0.00118    -2.04  4.13e-  2
 7 Bsmt_Unf_SF   -0.00963   0.00208    -4.63  3.82e-  6
 8 Total_Bsmt_SF  0.0293    0.00325     9.03  3.65e- 19
 9 First_Flr_SF   0.0429    0.00291    14.7   7.55e- 47
10 Second_Flr_SF  0.0514    0.00354    14.5   9.84e- 46
# … with 221 more rows</code></pre>
</div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Performance metrics on training data</span></span>
<span><span class="fu">glance</span><span class="op">(</span><span class="va">ames_fit</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1 × 12
  r.squared adj.r.sq…¹  sigma stati…² p.value    df logLik    AIC    BIC devia…³
      &lt;dbl&gt;      &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;
1     0.935      0.929 0.0476    161.       0   191  3905. -7424. -6313.    4.86
# … with 2 more variables: df.residual &lt;int&gt;, nobs &lt;int&gt;, and abbreviated
#   variable names ¹​adj.r.squared, ²​statistic, ³​deviance</code></pre>
</div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Plot variable importance</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/vip/man/vip.html">vip</a></span><span class="op">(</span><span class="va">ames_fit</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="step2_files/figure-html/metrics-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>#Evaluating the model</p>
<p>To assess the accuracy of our trained linear regression model, ames_fit, we must use it to make predictions on our test data, ames_test_proc. This is done with the <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> function from parnsip. This function takes two important arguments:</p>
<ul>
<li>a trained parnsip model object;</li>
<li>new_data for which to generate predictions.</li>
</ul>
<p>The code below uses the predict() function to generate a data frame with a single column, <em>.pred</em>, which contains the predicted Sale Price values on the ames_test data.</p>
<div class="cell">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">ames_fit</span>, new_data <span class="op">=</span> <span class="va">ames_test_proc</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in predict.lm(object = object$fit, newdata = new_data, type =
"response"): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 586 × 1
   .pred
   &lt;dbl&gt;
 1  5.04
 2  5.22
 3  5.39
 4  5.14
 5  5.23
 6  4.99
 7  4.99
 8  4.98
 9  5.14
10  5.76
# … with 576 more rows</code></pre>
</div>
</div>
<p><em>Warning: prediction from a rank-deficient fit may be misleading</em></p>
<p>One reason this warning occurs is that you have more model parameters than observations in the dataset. We refer to this as high dimensional data. With high dimensional data, it becomes impossible to find a model that can describe the relationship between the predictor variables and the response variable because we don’t have enough observations to train the model on. The easiest way to resolve this issue is to use a simpler model with less coefficients to estimate.We are not worrying about this today.</p>
<p>Generally it’s best to combine the test data set and the predictions into a single data frame. We create a data frame with the predictions on the ames_test data and then use <code><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols()</a></code> to add the ames_test data to the results.</p>
<div class="cell">
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_test_results</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">ames_fit</span>, new_data <span class="op">=</span> <span class="va">ames_test_proc</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">ames_test_proc</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in predict.lm(object = object$fit, newdata = new_data, type =
"response"): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># View results</span></span>
<span><span class="va">ames_test_results</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 586 × 232
   .pred Lot_F…¹ Lot_A…² Mas_V…³ BsmtF…⁴ BsmtF…⁵ Bsmt_…⁶ Total…⁷ First…⁸ Secon…⁹
   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
 1  5.04   0.675   0.172 -0.569    0.819   0.552 -0.657  -0.388   -0.689  -0.786
 2  5.22   0.705   0.488  0.0527  -1.42   -0.298 -0.347   0.670    0.456  -0.786
 3  5.39   0.916   0.145  1.45    -0.523  -0.298 -0.336   1.92     1.85   -0.786
 4  5.14   0.224  -0.207 -0.569   -0.970  -0.298 -0.632   0.0242  -0.266  -0.786
 5  5.23  -0.949  -0.516 -0.569   -0.523  -0.298 -0.466   0.850    0.477  -0.786
 6  4.99  -1.10   -1.01   2.33     0.819  -0.298 -0.527  -1.33    -1.78    0.392
 7  4.99  -1.10   -1.01   2.26     0.819  -0.298 -0.759  -1.23    -1.67    0.539
 8  4.98  -1.10   -1.01   1.62     1.27   -0.298 -0.0770 -1.23    -1.67    0.539
 9  5.14  -1.01   -0.943 -0.569   -1.42   -0.298 -0.495  -0.452   -0.797   0.618
10  5.76   1.58    0.492  5.74    -0.523  -0.298  2.08    4.26     4.07   -0.786
# … with 576 more rows, 222 more variables: Low_Qual_Fin_SF &lt;dbl&gt;,
#   Gr_Liv_Area &lt;dbl&gt;, Bsmt_Full_Bath &lt;dbl&gt;, Bsmt_Half_Bath &lt;dbl&gt;,
#   Full_Bath &lt;dbl&gt;, Half_Bath &lt;dbl&gt;, Bedroom_AbvGr &lt;dbl&gt;, Kitchen_AbvGr &lt;dbl&gt;,
#   TotRms_AbvGrd &lt;dbl&gt;, Fireplaces &lt;dbl&gt;, Garage_Cars &lt;dbl&gt;,
#   Garage_Area &lt;dbl&gt;, Wood_Deck_SF &lt;dbl&gt;, Open_Porch_SF &lt;dbl&gt;,
#   Enclosed_Porch &lt;dbl&gt;, Three_season_porch &lt;dbl&gt;, Screen_Porch &lt;dbl&gt;,
#   Pool_Area &lt;dbl&gt;, Misc_Val &lt;dbl&gt;, Mo_Sold &lt;dbl&gt;, Year_Sold &lt;dbl&gt;, …</code></pre>
</div>
</div>
<p>Now we have the model results and the test data in a single data frame.</p>
</section><section id="calculating-rmse-and-rsq-on-the-test-data" class="level3"><h3 data-anchor-id="calculating-rmse-and-rsq-on-the-test-data">Calculating rmse and rsq on the Test Data</h3>
<p>To obtain the rmse and rsq values on our test set results, we can use the <code>rmse()</code> and <code>rsq()</code> functions. Both functions take the following arguments:</p>
<ul>
<li>a data frame with columns that have the true values and predictions;</li>
<li>the column with the true response values;</li>
<li>the column with predicted values.</li>
</ul>
<p>In the examples below we pass our ames_test_results to these functions to obtain these values for our test set. Results are always returned as a data frame with the following columns: .metric, .estimator, and .estimate.</p>
<div class="cell">
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#RMSE on test set</span></span>
<span><span class="va">test_rmse</span> <span class="op">&lt;-</span> <span class="fu">rmse</span><span class="op">(</span><span class="va">ames_test_results</span>, </span>
<span>     truth <span class="op">=</span> <span class="va">Sale_Price</span>,</span>
<span>     estimate <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#rsq on test set</span></span>
<span><span class="va">test_rsq</span><span class="op">&lt;-</span> <span class="fu">rsq</span><span class="op">(</span><span class="va">ames_test_results</span>,</span>
<span>    truth <span class="op">=</span> <span class="va">Sale_Price</span>,</span>
<span>    estimate <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Challenge X
</div>
</div>
<div class="callout-body-container callout-body">
<p>We mentioned earlier that the <code>bake()</code> function takes a prepped recipe (ames_prep) and applies it to <code>new_data</code>. The new_data could be the training data again or it could be the testing data. We just evaluated our model on the test data, let’s try to apply the <code>bake()</code> and <code><a href="https://rdrr.io/r/stats/predict.html">predict()</a></code> functions on the training data and compare the results.</p>
<p><strong>Instructions</strong></p>
<div class="cell">
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#bake() training data</span></span>
<span></span>
<span><span class="co">#predict() selling price on the training data</span></span>
<span></span>
<span><span class="co">#combine the training data set and the predictions into a single data frame</span></span>
<span></span>
<span><span class="co">#RMSE on training set</span></span>
<span></span>
<span><span class="co">#rsq on training set</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#bake() training data</span></span>
<span><span class="va">ames_train_proc</span> <span class="op">&lt;-</span> <span class="fu">bake</span><span class="op">(</span><span class="va">ames_prep</span>, new_data <span class="op">=</span> <span class="va">ames_train</span><span class="op">)</span></span>
<span><span class="co">#predict() selling price on the training data</span></span>
<span><span class="va">ames_train_results</span> <span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">ames_fit</span>, new_data <span class="op">=</span> <span class="va">ames_train_proc</span><span class="op">)</span></span>
<span><span class="co">#combine the training data set and the predictions into a single data frame</span></span>
<span><span class="va">ames_train_results</span> <span class="op">&lt;-</span> <span class="va">ames_train_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_cols.html">bind_cols</a></span><span class="op">(</span><span class="va">ames_train_proc</span><span class="op">)</span></span>
<span><span class="co">#RMSE on training set</span></span>
<span><span class="va">train_rmse</span> <span class="op">&lt;-</span> <span class="fu">rmse</span><span class="op">(</span><span class="va">ames_train_results</span>, </span>
<span>     truth <span class="op">=</span> <span class="va">Sale_Price</span>,</span>
<span>     estimate <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span></span>
<span><span class="co">#rsq on training set</span></span>
<span><span class="va">train_rsq</span> <span class="op">&lt;-</span> <span class="fu">rsq</span><span class="op">(</span><span class="va">ames_train_results</span>,</span>
<span>    truth <span class="op">=</span> <span class="va">Sale_Price</span>,</span>
<span>    estimate <span class="op">=</span> <span class="va">.pred</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
<p>Let’s have a look at all the metrics for both our training and test datasets:</p>
<div class="cell">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#plot metrics for training and test datasets</span></span>
<span><span class="va">train_rsq</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"training"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">train_rmse</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"training"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">test_rsq</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">test_rmse</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>                          <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  .metric .estimator .estimate dataset 
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;   
1 rsq     standard      0.935  training
2 rmse    standard      0.0456 training
3 rsq     standard      0.862  test    
4 rmse    standard      0.0647 test    </code></pre>
</div>
</div>
<p>If we look at the testing data, the rmse is higher than the training data. Our training data is not giving us a good idea of how our model is going to perform. In this situation, our algorithm fits our existing data very well, but doesn’t generalise well on new data.</p>
<p>Let’s visualise the situation with an <strong>R2 plot</strong>:</p>
<div class="cell">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_test_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>train <span class="op">=</span> <span class="st">"testing"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html">bind_rows</a></span><span class="op">(</span><span class="va">ames_train_results</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>              <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>train <span class="op">=</span> <span class="st">"training"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">Sale_Price</span>, <span class="va">.pred</span>, color <span class="op">=</span> <span class="va">train</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">"black"</span>, size <span class="op">=</span> <span class="fl">0.5</span>, linetype<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">train</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Actual Selling Price"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Predicted Selling Price"</span>,</span>
<span>    color <span class="op">=</span> <span class="st">"Test/Training data"</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
ℹ Please use `linewidth` instead.</code></pre>
</div>
<div class="cell-output-display">
<p><img src="step2_files/figure-html/plot results-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>This is a plot that can be used for any regression model. It plots the actual values (Sale Prices) versus the model predictions (.pred) as a scatter plot. It also plot the line y = x through the origin. This line is a visually representation of the perfect model where all predicted values are equal to the true values in the test set. The farther the points are from this line, the worse the model fit. The reason this plot is called an R2 plot, is because the R2 is the squared correlation between the true and predicted values, which are plotted as paired in the plot.</p>
</section><section id="resampling" class="level3"><h3 data-anchor-id="resampling">Resampling</h3>
<p>We made not such a great decision in the previous section; we expected the model evaluated once on the whole training set to help us understand something about how it would perform on new data. Fortunately, we have some options. We can resample the training set to produce an estimate of how the model will perform.The idea of resampling is to create simulated data sets that can be used to estimate the performance of your model, say, because you want to compare models. You can create these resampled data sets instead of using either your training set (which can give overly optimistic results, especially for powerful ML algorithms) or your testing set (which is extremely valuable and can only be used once or at most twice). One of these resampling methods is cross-validation.</p>
<p><strong>Cross-validation</strong> means taking your training set and randomly dividing it up evenly into subsets, sometimes called “folds”. A fold here means a group or subset or partition.</p>
<p>You use one of the folds for validation and the rest for training, then you repeat these steps with all the subsets and combine the results, usually by taking the mean. Cross-validation allows you to get a more accurate estimate of how your model will perform on new data.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Challenge X
</div>
</div>
<div class="callout-body-container callout-body">
<p>When you implement 10-fold cross-validation repeated 5 times, you:</p>
<ul>
<li>randomly divide your training data into 50 subsets and train on 49 at a time (assessing on the other subset), iterating through all 50 subsets for assessment.</li>
<li>randomly divide your training data into 10 subsets and train on 9 at a time (assessing on the other subset), iterating through all 10 subsets for assessment. Then you repeat that process 5 times.</li>
<li>randomly divide your training data into 5 subsets and train on 4 at a time (assessing on the other subset), iterating through all 5 subsets. Then you repeat that process 10 times.</li>
</ul>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Simulations and practical experience show that 10-fold cross-validation repeated 5 times is a great resampling approach for many situations. This approach involves randomly dividing your training data into 10 folds, or subsets or groups, and training on only 9 while using the other fold for assessment. You iterate through all 10 folds being used for assessment; this is one round of cross-validation. You can then repeat the whole process multiple, perhaps 5, times.</p>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rsample.tidymodels.org/reference/vfold_cv.html">vfold_cv</a></span><span class="op">(</span><span class="va">ames_train</span>, v<span class="op">=</span><span class="fl">10</span>, repeats <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">ames_folds</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 50
Columns: 3
$ splits &lt;list&gt; [&lt;vfold_split[2105 x 234 x 2339 x 81]&gt;], [&lt;vfold_split[2105 x …
$ id     &lt;chr&gt; "Repeat1", "Repeat1", "Repeat1", "Repeat1", "Repeat1", "Repeat1…
$ id2    &lt;chr&gt; "Fold01", "Fold02", "Fold03", "Fold04", "Fold05", "Fold06", "Fo…</code></pre>
</div>
</div>
<p>In the next steps, we won’t not use <code>prep()</code> or <code>bake()</code>. The <code>ames_rec</code> recipe will be automatically applied in a later step using the <code>workflow()</code> and <code>last_fit()</code> functions.</p>
</section><section id="create-a-workflow" class="level3"><h3 data-anchor-id="create-a-workflow">Create a Workflow</h3>
<p>In the previous section, we trained a linear regression model to the housing data step-by-step. In this section, we will go over how to combine all of the modeling steps into a single workflow. The <code>workflow</code> package was designed to combine models and recipes into a single object. To create a workflow, we start with <code>workflow()</code> to create an empty workflow and then add out model and recipe with <code>add_model()</code> and <code>add_recipe()</code>.</p>
<div class="cell">
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">ames_wf</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">ames_model</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">ames_rec</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ames_wf</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>══ Workflow ════════════════════════════════════════════════════════════════════
Preprocessor: Recipe
Model: linear_reg()
── Preprocessor ────────────────────────────────────────────────────────────────
5 Recipe Steps
• step_other()
• step_nzv()
• step_center()
• step_scale()
• step_dummy()
── Model ───────────────────────────────────────────────────────────────────────
Linear Regression Model Specification (regression)
Computational engine: lm </code></pre>
</div>
</div>
<p>Once we have created a set of resamples, we can use the function <code>fit_resamples()</code> to fit a model to each resample and compute performance metrics for each.</p>
<div class="cell">
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">234</span><span class="op">)</span></span>
<span><span class="va">ames_res</span> <span class="op">&lt;-</span> <span class="va">ames_wf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">fit_resamples</span><span class="op">(</span></span>
<span>    <span class="va">ames_folds</span>,</span>
<span>    control <span class="op">=</span> <span class="fu">control_resamples</span><span class="op">(</span>save_pred <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold01, Repeat1: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold02, Repeat1: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold03, Repeat1: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold04, Repeat1: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold05, Repeat1: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold06, Repeat1: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold07, Repeat1: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold08, Repeat1: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold09, Repeat1: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold10, Repeat1: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold01, Repeat2: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold02, Repeat2: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold03, Repeat2: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold04, Repeat2: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold05, Repeat2: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold06, Repeat2: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold07, Repeat2: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold08, Repeat2: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold09, Repeat2: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold10, Repeat2: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold01, Repeat3: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold02, Repeat3: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold03, Repeat3: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold04, Repeat3: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold05, Repeat3: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold06, Repeat3: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold07, Repeat3: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold08, Repeat3: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold09, Repeat3: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold10, Repeat3: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold01, Repeat4: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold02, Repeat4: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold03, Repeat4: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold04, Repeat4: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold05, Repeat4: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold06, Repeat4: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold07, Repeat4: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold08, Repeat4: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold09, Repeat4: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold10, Repeat4: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold01, Repeat5: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold02, Repeat5: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold03, Repeat5: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold04, Repeat5: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold05, Repeat5: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold06, Repeat5: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold07, Repeat5: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold08, Repeat5: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold09, Repeat5: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>! Fold10, Repeat5: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="sourceCode" id="cb95"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">ames_res</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 50
Columns: 6
$ splits       &lt;list&gt; [&lt;vfold_split[2105 x 234 x 2339 x 81]&gt;], [&lt;vfold_split[2…
$ id           &lt;chr&gt; "Repeat1", "Repeat1", "Repeat1", "Repeat1", "Repeat1", "R…
$ id2          &lt;chr&gt; "Fold01", "Fold02", "Fold03", "Fold04", "Fold05", "Fold06…
$ .metrics     &lt;list&gt; [&lt;tbl_df[2 x 4]&gt;], [&lt;tbl_df[2 x 4]&gt;], [&lt;tbl_df[2 x 4]&gt;],…
$ .notes       &lt;list&gt; [&lt;tbl_df[1 x 3]&gt;], [&lt;tbl_df[1 x 3]&gt;], [&lt;tbl_df[1 x 3]&gt;],…
$ .predictions &lt;list&gt; [&lt;tbl_df[234 x 4]&gt;], [&lt;tbl_df[234 x 4]&gt;], [&lt;tbl_df[234 x…</code></pre>
</div>
<div class="sourceCode" id="cb97"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">saveRDS</a></span><span class="op">(</span><span class="va">ames_res</span>, <span class="st">"../_models/ames_res.rds"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The column .metric contains the performance statistics created from the 10 assessment sets. These can be manually unnested but the tune package contains a number of simple functions that can extract these data:</p>
<div class="cell">
<div class="sourceCode" id="cb98"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Obtain performance metrics on resampled training data</span></span>
<span><span class="va">ames_res</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">collect_metrics</span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  .metric .estimator   mean     n std_err .config             
  &lt;chr&gt;   &lt;chr&gt;       &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard   0.0537    50 0.00122 Preprocessor1_Model1
2 rsq     standard   0.909     50 0.00383 Preprocessor1_Model1</code></pre>
</div>
</div>
<ul>
<li>
<code><a href="https://rsample.tidymodels.org/reference/vfold_cv.html">vfold_cv()</a></code> creates folds for cross-validation;</li>
<li>
<code>fit_resamples()</code> fits models to resamples;</li>
<li>
<code>collect_metrics()</code> obtains performance metrics from the results.</li>
</ul>
<p>Notice that now we have a realistic estimate from the training data that is closer to the testing data!</p>
<p>If we wanted to try different model types for this data set, we could more confidently compare performance metrics computed using resampling to choose between models. Also, remember that at the end of our project, we return to our test set to estimate final model performance.</p>
<p>Let’s use the <code>last_fit()</code> function to evaluate once on the testing set:</p>
<div class="cell">
<div class="sourceCode" id="cb100"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#Final fit on test dataset</span></span>
<span><span class="va">ames_final</span> <span class="op">&lt;-</span> <span class="va">ames_wf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">last_fit</span><span class="op">(</span><span class="va">ames_split</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>! train/test split: preprocessor 1/1, model 1/1 (predictions): prediction from a rank-deficient fit may be misleading</code></pre>
</div>
<div class="sourceCode" id="cb102"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Obtain performance metrics on test data</span></span>
<span><span class="fu">collect_metrics</span><span class="op">(</span><span class="va">ames_final</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 4
  .metric .estimator .estimate .config             
  &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
1 rmse    standard      0.0647 Preprocessor1_Model1
2 rsq     standard      0.862  Preprocessor1_Model1</code></pre>
</div>
</div>
<p>The R-squared (rsq) and root mean squared error (RMSE) metrics are similar for both the training and testing datasets in our linear regression model. This is a good sign that the model is not over-fitting and can be used for making predictions on new data.</p>
<p>We can save the test set predictions by using the <code>collect_predictions()</code> function. This function returns a data frame which will have the response variables values from the test set and a column named .pred with the model predictions.</p>
<div class="cell">
<div class="sourceCode" id="cb104"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># Obtain test set predictions data frame</span></span>
<span><span class="va">ames_results_final</span> <span class="op">&lt;-</span> <span class="va">ames_final</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>                 <span class="fu">collect_predictions</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># View results</span></span>
<span><span class="va">ames_results_final</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 586 × 5
   id               .pred  .row Sale_Price .config             
   &lt;chr&gt;            &lt;dbl&gt; &lt;int&gt;      &lt;dbl&gt; &lt;chr&gt;               
 1 train/test split  5.04     2       5.02 Preprocessor1_Model1
 2 train/test split  5.22     3       5.24 Preprocessor1_Model1
 3 train/test split  5.39    18       5.60 Preprocessor1_Model1
 4 train/test split  5.14    26       5.15 Preprocessor1_Model1
 5 train/test split  5.23    29       5.26 Preprocessor1_Model1
 6 train/test split  4.99    30       4.98 Preprocessor1_Model1
 7 train/test split  4.99    31       5.02 Preprocessor1_Model1
 8 train/test split  4.98    32       4.94 Preprocessor1_Model1
 9 train/test split  5.14    34       5.18 Preprocessor1_Model1
10 train/test split  5.76    47       5.70 Preprocessor1_Model1
# … with 576 more rows</code></pre>
</div>
</div>
<p>Finally, let’s use this data frame to make an R2 plot to visualize our model performance on the test data set:</p>
<div class="cell">
<div class="sourceCode" id="cb106"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ames_results_final</span>,</span>
<span>       mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.pred</span>, y <span class="op">=</span> <span class="va">Sale_Price</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">'#006EA1'</span>, alpha <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">0</span>, slope <span class="op">=</span> <span class="fl">1</span>, color <span class="op">=</span> <span class="st">'black'</span>, size<span class="op">=</span><span class="fl">0.5</span>, linetype<span class="op">=</span><span class="st">"dotted"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'Linear Regression Results - Ames Test Set'</span>,</span>
<span>       x <span class="op">=</span> <span class="st">'Predicted Selling Price'</span>,</span>
<span>       y <span class="op">=</span> <span class="st">'Actual Selling Price'</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="step2_files/figure-html/plot final-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section></section></main></div>
    </div>
  </div>
</div>
<!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
      <div class="nav-footer-center">Copyright 2023, Sydney Informatics Hub</div>
  </div>
</footer>


</body></html>