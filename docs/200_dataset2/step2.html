<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<title>Sydney Informatics Hub – step2</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>
</head>
<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="navbar navbar-expand-lg navbar-dark "><div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">Sydney Informatics Hub</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
<li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../00_setup.html">
 <span class="menu-text">Setup</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../Introduction.html">
 <span class="menu-text">Introduction</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-1" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Session 1</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-1">
<li>
    <a class="dropdown-item" href="../100_dataset1/step1.html">
 <span class="dropdown-text">Predict the house sale price in Iowa - EDA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../100_dataset1/step2.html">
 <span class="dropdown-text">Get started with tidymodels</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-2" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Session 2</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-2">
<li>
    <a class="dropdown-item" href="../200_dataset2/step1.html">
 <span class="dropdown-text">Predict what makes a developer more likely to work remotely - EDA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../200_dataset2/step2.html">
 <span class="dropdown-text">Preprocess with a recipe</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session3-" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Session3</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session3-">
<li>
    <a class="dropdown-item" href="../300_dataset3/step1.html">
 <span class="dropdown-text">Predict which wine features are the best quality wine indicators - EDA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../300_dataset3/step2.html">
 <span class="dropdown-text">Create a modeling workflow</span></a>
  </li>  
    </ul>
</li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-session-4" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Session 4</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-session-4">
<li>
    <a class="dropdown-item" href="../400_dataset4/step1.html">
 <span class="dropdown-text">Predict whether a cancer is malignant or benign from biopsy details - EDA</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../400_dataset4/step2.html">
 <span class="dropdown-text">Work with model hyperparameters</span></a>
  </li>  
    </ul>
</li>
</ul>
<div class="quarto-toggle-container">
                  <a href="" class="quarto-color-scheme-toggle nav-link" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<div class="quarto-about-solana column-body">
  <div class="about-entity">
    <div class="entity-contents">
      <div class="about-contents"><main class="content" id="quarto-document-content"><div class="cell">
</div>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Learning objective:
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>Build a ML model for predicting whether a person has diabetes or not;</li>
</ul>
</div>
</div>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Exercise:
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this case study, you could make predictions about whether a patient will develop diabetes or not based on their medical and demographic variables. What kind of model will you build?</p>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Unlike the first case study, when we built regression models to predict a numeric or continuous variable, in this case study we are going to build classification models, to predict the class: diabetes or no diabetes.</p>
</div>
</div>
</div>
<section id="what-is-a-classifier" class="level2"><h2 data-anchor-id="what-is-a-classifier">What is a classifier?</h2>
<hr>
<p>A classifier is some kind of rule / black box / widget that you can feed a new example and it will spit out whether or not it is part of a given class. E.g. below, we are classifying the animals to be either <em>cat</em> or <em>not cat</em>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../fig/CatNotCat.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">A classifier for cats and not cats.</figcaption><p></p>
</figure>
</div>
<p>You can have classifiers for anything you can have a yes/no answer to, e.g.</p>
<ul>
<li>Is this a cat? 🐱</li>
<li>Do these test results indicate cancer? 🚑</li>
<li>Is this email spam or not spam? 📧</li>
</ul>
<p>You can also have classifiers that categorise things into multiple (more than two) categories e.g.</p>
<ul>
<li>Which animal is this, out of the 12 animals I have trained my model on? 🐱</li>
<li>Do these test results indicate {none, stage 1, stage 2, stage 3, stage 4} cancer? 🚑</li>
<li>Is this email important, not important but not spam, or spam? 📧</li>
</ul>
<p>It is clear that in some of these examples we are more concerned with being wrong in one direction than the other, e.g.&nbsp;it’s better to let some spam email through accidentally than to block all of it but also junk important emails from people you know. Likewise, we would prefer our medical tests to err on the side of caution and not give a negative test result to someone who needs treatment. So we will need to adjust a parameter to decide how much we want to trade this off.</p>
</section><section id="model-evaluation-classification" class="level2"><h2 data-anchor-id="model-evaluation-classification">Model evaluation (classification)</h2>
<hr>
<p>For now, let’s imagine we have a classifier already. How can we test it to see how good it is? A good start is a confusion matrix - a table of what test data it labels correctly and incorrectly.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../fig/_CatConfusion.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Demonstration of a confusion matrix for a cat classifier that has labelled 100 animals as cats or not-cats.</figcaption><p></p>
</figure>
</div>
<section id="confusion-matrix" class="level3"><h3 data-anchor-id="confusion-matrix">Confusion Matrix</h3>
<hr>
<p>When applying classification models, we often use a confusion matrix to evaluate certain performance measures. A confusion matrix is a matrix that compares “the truth” to the labels generated by your classifier. When we label a cat correctly, we refer to this as a true positive. When we fail to label a cat as a cat, this is called a false negative. However, if we label something which is not a cat as a cat, this is called a false positive; and if we correctly label something which is not a cat, as not a cat, then this is a true negative. In our case, the confusion matrix will look like this:</p>
<ul>
<li>
<strong>true positive (TP)</strong> : Diabetic correctly identified as diabetic</li>
<li>
<strong>true negative (TN)</strong> : Healthy correctly identified as healthy</li>
<li>
<strong>false positive (FP)</strong> : Healthy incorrectly identified as diabetic</li>
<li>
<strong>false negative (FN)</strong> : Diabetic incorrectly identified as healthy</li>
</ul></section><section id="some-common-classification-metrics" class="level3"><h3 data-anchor-id="some-common-classification-metrics">Some common classification metrics</h3>
<hr>
<p>Don’t worry if you forget some of these - there are so many different words used to describe different ways to divide up the confusion matrix, it can get very confusing. I swear each time <a href="https://en.wikipedia.org/wiki/Sensitivity_and_specificity#Confusion_matrix">I just look up wikipedia again</a> to figure out which part of the confusion matrix to look at. There are even more there that we won’t even bother talking about here.</p>
<section id="accuracy" class="level4 border"><h4 data-anchor-id="accuracy">
<strong>Accuracy</strong>:</h4>
<p>How often does the classifier label examples correctly? Objective: maximize. Example:</p>
<p><span class="math display">\[\frac{TP+TN}{TP+TN+FP+FN} = \frac{\text{Correctly labelled examples}}{\text{All examples}}=\frac{31+52}{31+52+10+7}=83\%\]</span></p>
<p>Accuracy is the opposite of the misclassification rate. So,</p>
<p><span class="math display">\[\text{Misclassification rate} = 1 - \text{Accuracy} = \frac{\text{Incorrectly labelled examples}}{\text{All examples}}\]</span></p>
</section><section id="precision" class="level4 border"><h4 data-anchor-id="precision">
<strong>Precision</strong>:</h4>
<p>What fraction of things labelled as a cat were actually cats? Objective: maximize. Example:</p>
<p><span class="math display">\[\frac{TP}{TP+FP} = \frac{\text{Correctly labelled cats}}{\text{All things labelled as cats}}=\frac{31}{31+10}=76\%\]</span></p>
</section><section id="sensitivity-recall" class="level4 border"><h4 data-anchor-id="sensitivity-recall">
<strong>Sensitivity / Recall</strong>:</h4>
<p>How often does the classifier label a cat as a cat? Objective: maximize. Example:</p>
<p><span class="math display">\[\frac{TP}{TP+FN} = \frac{\text{Correctly labelled cats}}{\text{All true cats}}=\frac{31}{31+7}=81\%\]</span></p>
</section><section id="specificity" class="level4 border"><h4 data-anchor-id="specificity">
<strong>Specificity</strong>:</h4>
<p>How often does it label a not-cat as a not-cat? Objective: maximize. Example:</p>
<p><span class="math display">\[\frac{TN}{TN+FP} = \frac{\text{Correctly labelled not-cats}}{\text{All true not-cats}}=\frac{52}{52+10}=84\%\]</span></p>
</section><section id="f1-score" class="level4 border"><h4 data-anchor-id="f1-score">
<strong>F1-score</strong>:</h4>
<p>This is a commonly used overall measure of classifier performance (but not the only one and not always the best depending upon the problem). It is defined as the harmonic mean of precision and sensitivity;</p>
<p><span class="math display">\[\frac{1}{F_1} = \frac{1}{2}\left(\frac{1}{\text{Precision}}+\frac{1}{\text{Sensitivity}}\right)\]</span></p>
<p>So that</p>
<p><span class="math display">\[F_1 = 2\cdot\left(\frac{1}{\frac{1}{81\%}+\frac{1}{83\%}}\right) = 82\%\]</span></p>
</section></section><section id="auc-area-under-the-curve" class="level3"><h3 data-anchor-id="auc-area-under-the-curve">AUC: Area under the curve</h3>
<hr>
<p>A good classifier will have high precision and high specificity, minimizing both false positives and false negatives. In practice, and with an imperfect classifier, you can tune a knob to say which of those two you care more about. There will be some kind of a trade-off between the two.</p>
<p>To capture this balance, we often use a Reciever Operator Characteristic (ROC) curve that plots the false positive rate along the x-axis and the true positive rate along the y-axis, for all possible trade-offs. A line that is diagonal from the lower left corner to the upper right corner represents a random guess at labelling each example. The higher the line is in the upper left-hand corner, the better the classifier in general. AUC computes the area under this curve. For a perfect classifier, AUC = 1, for a random guess, AUC=0.5. Objective: maximize.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="../fig/_CatArea.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">A Reciever Operator Characteristic (ROC) curve, from which the Area Under the Curve (AUC) can be calculated.</figcaption><p></p>
</figure>
</div>
<blockquote class="blockquote">
<p>For additional discussion of classification error metrics, see <a href="https://doi.org/10.1016/j.aci.2018.08.003">Tharwat 2018</a>, for example.</p>
</blockquote>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Challenge 1
</div>
</div>
<div class="callout-body-container callout-body">
<ul>
<li>In the case of patients with a rare disease, what can be the problem of using accuracy to evaluate the performance of a machine learning model.</li>
</ul>
</div>
</div>
<div class="callout-caution callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Accuracy is calculated as the (TP + TN)/(total) number of cases in the dataset. If you have very few positive cases, such as when working with a rare disease, the numerator of this fraction will be dominated by the true negatives you accurately predict in your dataset - so not very informative when assessing whether your classifier predicts the disease well at all!</p>
</div>
</div>
</div>
<div class="cell" data-hash="step2_cache/html/libraries_ce8eb3ea4dbf403c429e93f9673d37bc">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidymodels.tidymodels.org">tidymodels</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/workflows">workflows</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tune.tidymodels.org/">tune</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_minimal</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section><section id="tree-based-models" class="level3"><h3 data-anchor-id="tree-based-models">Tree-based models</h3>
</section><section id="logistic-regression" class="level3"><h3 data-anchor-id="logistic-regression">Logistic regression</h3>
</section></section><section id="tune-model-hyperparameters" class="level2"><h2 data-anchor-id="tune-model-hyperparameters">Tune model hyperparameters</h2>
<hr>
<p>Some model parameters cannot be learned directly from a dataset during model training; these kinds of parameters are called <strong>hyperparameters</strong>. Some examples of hyperparameters include the number of randomly selected variables to be considered at each split in a tree-based model (called <code>mtry</code> in tidymodels).</p>
<p>Instead of learning these kinds of hyperparameters during model training, we can estimate the best values for these values by training many models on a resampled data set (like the cross-validation folds we have previously created) and measuring how well all these models perform. This process is called *<strong>tuning</strong>.</p>
<p>You can identify which parameters to <code><a href="https://hardhat.tidymodels.org/reference/tune.html">tune()</a></code> in a model specification.</p>
<p>We will focus on</p>
<div class="cell" data-hash="step2_cache/html/tune_06043bcc80ca500f4bc7a601391093d5">
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rf_model_diabetes</span> <span class="op">&lt;-</span> </span>
<span>  <span class="co"># specify that the model is a random forest</span></span>
<span>  <span class="fu">rand_forest</span><span class="op">(</span>mtry <span class="op">=</span> <span class="fu"><a href="https://hardhat.tidymodels.org/reference/tune.html">tune</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># specify that the `mtry` parameter needs to be tuned</span></span>
<span>  <span class="co"># select the engine/package that underlies the model</span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"ranger"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co"># choose either the continuous regression or binary classification mode</span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<blockquote class="blockquote">
<p><strong>Note</strong> Nothing about this model specification is specific to the diabetes dataset.</p>
</blockquote>
<section id="optimize-tuning-parameters" class="level3"><h3 data-anchor-id="optimize-tuning-parameters">Optimize tuning parameters</h3>
<div class="borders">
<ul>
<li>Try different values and measure their performance;</li>
<li>Find good values for these parameters;</li>
<li>Once the value(s) of the parameter(s) are determined, a model can be finalized by fitting the model to the entire training set.</li>
</ul>
</div>
<p>You have a couple of options for how to choose which possible values for the tuning parameters to try.</p>
<ul>
<li>We can use the function <code><a href="https://tune.tidymodels.org/reference/tune_grid.html">tune_grid()</a></code> to tune either a workflow or a model specification with a set of resampled data, such as the validation set you created (i.e.&nbsp;a single resample).</li>
</ul>
<div class="cell" data-hash="step2_cache/html/tune_grid_55d9bdb08289712fb0b85ac45bd191aa">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">245</span><span class="op">)</span></span>
<span></span>
<span><span class="va">diabetes_rec</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"../_models/diabetes_rec.rds"</span><span class="op">)</span></span>
<span><span class="va">diabetes_folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"../_models/diabetes_folds.rds"</span><span class="op">)</span></span>
<span><span class="va">rf_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tune.tidymodels.org/reference/tune_grid.html">tune_grid</a></span><span class="op">(</span></span>
<span>  <span class="va">rf_model_diabetes</span>,</span>
<span>  <span class="va">diabetes_rec</span>,</span>
<span>  resamples <span class="op">=</span> <span class="va">diabetes_folds</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rf_grid</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># Tuning results
# 10-fold cross-validation repeated 5 times using stratification 
# A tibble: 50 × 5
   splits           id      id2    .metrics          .notes          
   &lt;list&gt;           &lt;chr&gt;   &lt;chr&gt;  &lt;list&gt;            &lt;list&gt;          
 1 &lt;split [483/54]&gt; Repeat1 Fold01 &lt;tibble [14 × 5]&gt; &lt;tibble [0 × 3]&gt;
 2 &lt;split [483/54]&gt; Repeat1 Fold02 &lt;tibble [14 × 5]&gt; &lt;tibble [0 × 3]&gt;
 3 &lt;split [483/54]&gt; Repeat1 Fold03 &lt;tibble [14 × 5]&gt; &lt;tibble [0 × 3]&gt;
 4 &lt;split [483/54]&gt; Repeat1 Fold04 &lt;tibble [14 × 5]&gt; &lt;tibble [0 × 3]&gt;
 5 &lt;split [483/54]&gt; Repeat1 Fold05 &lt;tibble [14 × 5]&gt; &lt;tibble [0 × 3]&gt;
 6 &lt;split [483/54]&gt; Repeat1 Fold06 &lt;tibble [14 × 5]&gt; &lt;tibble [0 × 3]&gt;
 7 &lt;split [483/54]&gt; Repeat1 Fold07 &lt;tibble [14 × 5]&gt; &lt;tibble [0 × 3]&gt;
 8 &lt;split [484/53]&gt; Repeat1 Fold08 &lt;tibble [14 × 5]&gt; &lt;tibble [0 × 3]&gt;
 9 &lt;split [484/53]&gt; Repeat1 Fold09 &lt;tibble [14 × 5]&gt; &lt;tibble [0 × 3]&gt;
10 &lt;split [484/53]&gt; Repeat1 Fold10 &lt;tibble [14 × 5]&gt; &lt;tibble [0 × 3]&gt;
# … with 40 more rows</code></pre>
</div>
</div>
<p>Use <code>collect_metrics</code> to extract the metrics calculated from the cross-validation performance across the different values of the parameters:</p>
<div class="cell" data-hash="step2_cache/html/collect tuning metrics_0eb89a36abfdbdbb53e666e70cf26331">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#collect metrics</span></span>
<span><span class="va">rf_grid</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tune.tidymodels.org/reference/collect_predictions.html">collect_metrics</a></span><span class="op">(</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 14 × 7
    mtry .metric  .estimator  mean     n std_err .config             
   &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
 1     7 accuracy binary     0.762    50 0.00796 Preprocessor1_Model1
 2     7 roc_auc  binary     0.839    50 0.00766 Preprocessor1_Model1
 3     8 accuracy binary     0.759    50 0.00850 Preprocessor1_Model2
 4     8 roc_auc  binary     0.837    50 0.00764 Preprocessor1_Model2
 5     1 accuracy binary     0.761    50 0.00843 Preprocessor1_Model3
 6     1 roc_auc  binary     0.846    50 0.00762 Preprocessor1_Model3
 7     2 accuracy binary     0.765    50 0.00805 Preprocessor1_Model4
 8     2 roc_auc  binary     0.846    50 0.00750 Preprocessor1_Model4
 9     6 accuracy binary     0.760    50 0.00805 Preprocessor1_Model5
10     6 roc_auc  binary     0.839    50 0.00770 Preprocessor1_Model5
11     5 accuracy binary     0.766    50 0.00725 Preprocessor1_Model6
12     5 roc_auc  binary     0.841    50 0.00769 Preprocessor1_Model6
13     4 accuracy binary     0.767    50 0.00794 Preprocessor1_Model7
14     4 roc_auc  binary     0.844    50 0.00742 Preprocessor1_Model7</code></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">#see which model performed the best, in terms of some given metric</span></span>
<span><span class="va">rf_grid</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tune.tidymodels.org/reference/show_best.html">show_best</a></span><span class="op">(</span><span class="st">"roc_auc"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
   mtry .metric .estimator  mean     n std_err .config             
  &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1     2 roc_auc binary     0.846    50 0.00750 Preprocessor1_Model4
2     1 roc_auc binary     0.846    50 0.00762 Preprocessor1_Model3
3     4 roc_auc binary     0.844    50 0.00742 Preprocessor1_Model7
4     5 roc_auc binary     0.841    50 0.00769 Preprocessor1_Model6
5     6 roc_auc binary     0.839    50 0.00770 Preprocessor1_Model5</code></pre>
</div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">rf_grid</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tune.tidymodels.org/reference/show_best.html">show_best</a></span><span class="op">(</span><span class="st">"accuracy"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 7
   mtry .metric  .estimator  mean     n std_err .config             
  &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               
1     4 accuracy binary     0.767    50 0.00794 Preprocessor1_Model7
2     5 accuracy binary     0.766    50 0.00725 Preprocessor1_Model6
3     2 accuracy binary     0.765    50 0.00805 Preprocessor1_Model4
4     7 accuracy binary     0.762    50 0.00796 Preprocessor1_Model1
5     1 accuracy binary     0.761    50 0.00843 Preprocessor1_Model3</code></pre>
</div>
</div>


</section></section></main></div>
    </div>
  </div>
</div>
<!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
      <div class="nav-footer-center">Copyright 2023, Sydney Informatics Hub</div>
  </div>
</footer>


</body></html>